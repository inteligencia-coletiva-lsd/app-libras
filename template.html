<script type="text/javascript" src="http://malsup.github.com/jquery.blockUI.js"></script>

<div class="row">
    <!-- Success and Error Messages for the user -->
    <div class="span6 offset2" style="height:50px">
        <div id="success" class="alert alert-success" style="display:none;">
            <a class="close">×</a>
            <strong>Well done!</strong> Your answer has been saved
        </div>
        <div id="loading" class="alert alert-info" style="display:none;">
            <a class="close">×</a>
            Loading next task...
        </div>
        <div id="taskcompleted" class="alert alert-info" style="display:none;">
            <strong>The task has been completed!</strong> Thanks a lot!
        </div>
        <div id="finish" class="alert alert-success" style="display:none;">
            <strong>Congratulations!</strong> You have participated in all available tasks!
            <br/>
            <div class="alert-actions">
                <a class="btn small" href="/">Go back</a>
                <a class="btn small" href="/app">or, Check other applications</a>
            </div>
        </div>
        <div id="error" class="alert alert-error" style="display:none;">
            <a class="close">×</a>
            <strong>Error!</strong> Something went wrong, please contact the site administrators
        </div>
    </div> <!-- End Success and Error Messages for the user -->
</div> <!-- End of Row -->

<!--
    Task DOM for loading the Flickr Images
    It uses the class="skeleton" to identify the elements that belong to the
    task.
-->
<div class="skeleton"> <!-- Start Skeleton -->
    <h1 id="question">Pergunta</h1> <!-- The question will be loaded here -->
</div><!-- End of Skeleton -->

<div class="skeleton"> <!-- Start Skeleton -->
    <div id="signal_video" style="float: left;">video here</div><!-- The video will be showed here -->
    <div id="avatar_video" style="float: right; display: none;">video here</div>
  
    <div id="quantidade_maos" style="display: none"> <!-- Start DIV for the submission buttons -->
        <!-- If the user clicks this button, the saved answer will be value="yes"-->
        <button class="btn btn-large btn-info btn-answer" style="margin: 0px 0px 0px 10px; width: 200px" value='uma'>
            Uma m&atilde;o
        </button><br/>
        <!-- If the user clicks this button, the saved answer will be value="no"-->
        <button class="btn btn-large btn-info btn-answer" style="margin: 5px 0px 0px 10px; width: 200px"  value='duas'>
            Duas m&atilde;os
        </button><br/>
        <!-- If the user clicks this button, the saved answer will be value="NotKnown"
        <button class="btn btn-large btn-info btn-answer" style="margin: 5px 0px 0px 10px; width: 200px" value='Nenhuma'>
            Nenhuma m&atilde;o
        </button> -->
    </div><!-- End of DIV for the submission buttons -->


    <div id="orientacao_palma_da_mao" style="display: none">
        <!-- Ori 1 -->
        <div class="palma_image" style="margin: 0px 0 0 5px; float: left;">
            <button class="btn btn-answer" type="button" value="Ori_1">
                <img src="http://bit.ly/166zJWo" width="82px" height="106px"/>
            </button>
        </div>
        <!-- Ori 2 -->
        <div class="palma_image"style="margin: 0px 0 0 5px; float: left;">
            <button class="btn btn-answer" type="button" value="Ori_2">
                <img src="http://bit.ly/10IL8Zp" width="82px" height="106px"/>
            </button>   
        </div>
        <!-- Ori 3 -->
        <div class="palma_image" style="margin: 0px 0 0 5px; float: left;">
            <button class="btn btn-answer" type="button" value="Ori_3">
                <img src="http://bit.ly/11yVCw2" width="82px" height="106px"/>
            </button>
        </div>
        <!-- Ori 4 -->
        <div class="palma_image" style="margin: 0px  0px 0px 5px; float: left;">
            <button class="btn btn-answer" type="button" value="Ori_4">
                <img src="http://bit.ly/10o8PEB" width="82px" height="106px"/>
            </button>
        </div>
        <!-- Ori 5 -->
        <div class="palma_image" style="margin: 0px 0 0 5px; float: left;">
            <button class="btn btn-answer" type="button" value="Ori_5">
                <img src="http://bit.ly/15G9cPA"  width="82px" height="106px"/>
            </button>
        </div>
        <!-- Ori 6 -->
        <div class="palma_image" style="margin: 0px 0 0 5px; float: left;">
            <button class="btn btn-answer" type="button" value="Ori_6">
                <img src="http://bit.ly/14hLm8f" width="82px" height="106px"/>
            </button> 
        </div>
        <!-- Ori 7 -->
        <div class="palma_image" style="margin: 0px 0 0 5px; float: left;">
            <button class="btn btn-answer" type="button" value="Ori_7">
                <img src="http://bit.ly/YFbHMK" width="82px" height="106px"/>
            </button>
        </div>
        <!-- Ori 8 -->
        <div class="palma_image" style="margin: 0px 0px 0px 5px; float: left;">
            <button class="btn btn-answer" type="button" value="Ori_8">
                <img src="http://bit.ly/YFbxF3" width="82px" height="106px"/>
            </button>
        </div>
        <!-- Ori 9 -->
        <div class="palma_image" style="margin: 0px 0px 0px 5px; float: left;">
            <button class="btn btn-answer" type="button" value="Ori_9">
                <img src="http://bit.ly/11yVwo9" width="82px" height="106px"/>
            </button>
        </div>
        <!-- Ori 10 --> 
        <div class="palma_image" style="margin: 0px 0px 0px 5px; float: left;">
            <button class="btn btn-answer" type="button" value="Ori_10">
                <img src="http://bit.ly/10EeUtF"  width="82px" height="106px"/>
            </button>
        </div>
        <!-- Ori 11 -->
        <div class="palma_image" style="margin: 0px 0px 0px 5px; float: left">
            <button class="btn btn-answer" type="button" value="Ori_11">
                <img src="http://bit.ly/18G71uf" width="82px" height="106px"/>
            </button>
        </div>
        <!-- Ori 12 --> 
        <div class="palma_image" style="marg:in: 0px 0 0 5px; float: left">
            <button class="btn btn-answer" type="button" value="Ori_12">
                <img src="http://bit.ly/13n6Ql3"  width="82px" height="106px"/>
            </button>
        </div>
    </div><!-- End of orientacao_palma_da_mao -->
    <section id="expressao_facial" style="display: none">
      <div class="pagination" style="padding: 0; margin: 0 0 0 0">
        <ul style="padding: 0; margin: 0 0 0 20px">
          <li data-exp_group="prev"><a href="#">Prev</a></li>
          <li data-exp_group="group_1"><a href="#">1</a></li>
          <li data-exp_group="group_2"><a href="#">2</a></li>
          <li data-exp_group="group_3"><a href="#">3</a></li>
          <li data-exp_group="next"><a href="#">Next</a></li>
        </ul>
      </div>
      <div class="clear"></div>
      <ul style="padding: 0; margin: 0 0 0 0">
        <li class="exp" title=""  data-exp_facial="" ></li>
        <li class="exp" title=""  data-exp_facial="" ></li>
        <li class="exp" title=""  data-exp_facial="" ></li>
        <li class="exp" title=""  data-exp_facial="" ></li>
        <li class="exp" title=""  data-exp_facial="" ></li>
        <li class="exp" title=""  data-exp_facial="" ></li>
      </ul>
    </section> <!-- Fim da expressao facial -->
    <div id="ponto_de_articulacao" style="display: none">
        <map name="avatar_completo" id="avatar_completo">   
          <!-- Cabeca -->
          <area title="topo da cabeca"    shape="rect" coords="105, 0, 215, 25"    href="#"  data-local="Pa_63" />
          <area title="testa"             shape="rect" coords="105, 30, 215, 55"   href="#"  data-local="Pa_60" />
          <area title="olho direito"      shape="rect" coords="125, 65, 155, 90"   href="#"  data-local="Pa_35" />
          <area title="olho esquerdo"     shape="rect" coords="170, 65, 200, 90"   href="#"  data-local="Pa_38" />
          <area title="nariz"             shape="rect" coords="145, 85, 175, 105"  href="#"  data-local="Pa_32" />
          <area title="boca"              shape="rect" coords="145, 110, 175, 130" href="#"  data-local="Pa_6"  />
          <area title="queixo"            shape="rect" coords="145, 130, 175, 150" href="#"  data-local="Pa_57" />
          <area title="pescoco"           shape="rect" coords="145, 155, 175, 175" href="#"  data-local="Pa_56" />
          <area title="bochecha direita"  shape="rect" coords="115, 100, 145, 120" href="#"  data-local="Pa_9"  />
          <area title="bochecha esquerda" shape="rect" coords="180, 100, 210, 120" href="#"  data-local="Pa_9"  />
          <area title="orelha direita"    shape="rect" coords="90, 70, 120, 95"    href="#"  data-local="Pa_50" />
          <area title="orelha esquerda"   shape="rect" coords="200, 70, 230, 95"   href="#"  data-local="Pa_53" />
          
          <!-- Tronco -->
          <area title="ombro centro"     shape="rect" coords="145, 190, 160, 215" href="#"  data-local="Pa_41" /> 
          <area title="ombro direito"    shape="rect" coords="55, 190, 80, 215"   href="#"  data-local="Pa_44" />
          <area title="ombro esquerdo"   shape="rect" coords="240, 190, 265, 215" href="#"  data-local="Pa_47" />
          <area title="busto centro"     shape="rect" coords="145, 260, 160, 285" href="#"  data-local="Pa_12" />
          <area title="busto direito"    shape="rect" coords="85, 260, 110, 285"  href="#"  data-local="Pa_15" />
          <area title="busto esquerdo"   shape="rect" coords="210, 260, 235, 285" href="#"  data-local="Pa_18" />
          <area title="estomago"         shape="rect" coords="150, 350, 175, 375" href="#"  data-local="Pa_21" />
          <area title="umbigo"           shape="rect" coords="150, 415, 175, 440" href="#"  data-local="Pa_66" />
          <area title="cintura direita"  shape="rect" coords="80, 415, 105, 440"  href="#"  data-local="Pa_24" />
          <area title="cintura esquerda" shape="rect" coords="215, 415, 240, 440" href="#"  data-local="Pa_27" />
        </map>

        <map name="avatar_distancia" id="avatar_distancia">
          <area title="pequena" shape="rect" coords="65, 205, 115, 255"  href="#"  data-local="0" />
          <area title="media"   shape="rect" coords="145, 205, 195, 255" href="#"  data-local="1" />
          <area title="grande"  shape="rect" coords="240, 205, 290, 255" href="#"  data-local="2" />
        </map>
        
        <img id="avatar_completo_img"  src="http://bit.ly/10lA9nE" style="margin: 2px 0 0 2px" usemap="#avatar_completo" />
        <img id="avatar_distancia_img" src="http://bit.ly/10Y64tS" style="margin: 2px 0 0 2px; display: none" usemap="#avatar_distancia" />
    </div><!-- End of ponto de articulacao -->
    <!-- Formas de mao -->
    <section id="tipos_de_mao" style="display: none">
      <ul>
        <li data-handshape='tipo_1'></li>
        <li data-handshape='tipo_2'></li>
        <li data-handshape="tipo_3"></li>
        <li data-handshape="tipo_4"></li>
        <li data-handshape="tipo_5"></li>
        <li data-handshape="tipo_6"></li>
        <li data-handshape="tipo_7"></li>
        <li data-handshape="tipo_8"></li>
        <li data-handshape="tipo_9"></li>
        <li data-handshape="tipo_10"></li>
        <li data-handshape="tipo_11"></li>
        <li data-handshape="tipo_12"></li>
        <li data-handshape=""></li>
        <li data-handshape="tipos"><img src="http://imageshack.us/a/img832/4817/backqb.png" /></li>
      </ul>
    </section> <!-- Fim de formas de mao -->
</div><!-- End of Skeleton -->

<div class="row skeleton">
    <div class="span6">
        <!-- Feedback items for the user -->
        <p>You are working now on task: <span id="task-id" class="label label-warning">#</span></p>
        <p>You have completed: <span id="done" class="label label-info"></span> tasks from
        <!-- Progress bar for the user -->
        <span id="total" class="label label-inverse"></span></p>
        <div class="progress progress-striped">
            <div id="progress" rel="tooltip" title="#" class="bar" style="width: 0%;"></div>
        </div>
       
        <!-- 
            This application uses Disqus to allow users to provide some feedback.
            The next section includes a button that when a user clicks on it will
            load the comments, if any, for the given task
        -->
        <div id="disqus_show_btn" style="margin-top:5px;">
            <button class="btn btn-primary btn-large btn-disqus" onclick="loadDisqus()"><i class="icon-comments"></i> Show comments</button>
            <button class="btn btn-large btn-disqus" onclick="loadDisqus()" style="display:none"><i class="icon-comments"></i> Hide comments</button>
        </div><!-- End of Disqus Button section -->
        <!-- Disqus thread for the given task -->
        <div id="disqus_thread" style="margin-top:5px;display:none"></div>
    </div>
</div>


<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

    /* * * DON'T EDIT BELOW THIS LINE * * */
    function loadDisqus() {
    $("#disqus_thread").toggle();
    $(".btn-disqus").toggle();
    var disqus_shortname = 'pybossa'; // required: replace example with your forum shortname
    //var disqus_identifier = taskId;
    var disqus_developer = 1;

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    }

</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<script>
function loadUserProgress() {
    pybossa.userProgress('flickrperson').done(function(data){
        var pct = Math.round((data.done*100)/data.total);
        $("#progress").css("width", pct.toString() +"%");
        $("#progress").attr("title", pct.toString() + "% completed!");
        $("#progress").tooltip({'placement': 'left'});
        $("#total").text(data.total);
        $("#done").text(data.done);
    });
}

pybossa.taskLoaded(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        deferred.resolve(task);
    }
    else {
        deferred.resolve(task);
    }
});

pybossa.presentTask(function(task, deferred) {
    var exp_facial = { "group_1" : { "Exp_1" : "Bico", 
                                     "Exp_2" : "Bochechas infladas", 
                                     "Exp_3" : "Bochechas contraidas",
                                     "Exp_4" : "Labios contradidos",
                                     "Exp_5" : "Olhos para a direita",
                                     "Exp_6" : "Olhos para a esquerda" },
                       "group_2" : { "Exp_7" : "Lingua para baixo",
                                     "Exp_8" : "Lingua reta",
                                     "Exp_9" : "Neutra",
                                     "Exp_10" : "Olhos arregalados",
                                     "Exp_11" : "Sobrancelhas levantadas",
                                     "Exp_12" : "Sobrancelha franzida"  },
                       "group_3" : { "Exp_13" : "Bochecha direita inflada",
                                     "Exp_14" : "Susto",
                                     "Exp_15" : "Triste",
                                     "Exp_16" : "Raiva",
                                     "Exp_17" : "Desconfiado" } 
                     };
    
    var current_exp_group;
    var parametros = {right : {}, left : {}};
    var state = "TIPOS_MAO";
    var isRightHand = true;

    var grupo = new Object();
    grupo['tipo_1'] = new Array("mao_12", "mao_13", "mao_14", "mao_16");
    grupo['tipo_2'] = new Array("mao_33", "mao_34", "mao_47", "mao_48");
    grupo['tipo_3'] = new Array("mao_21", "mao_23", "mao_24", "mao_31", "mao_35", "mao_36", "mao_37", "mao_49");
    grupo['tipo_4'] = new Array("mao_8", "mao_52", "mao_54");
    grupo['tipo_5'] = new Array("mao_25", "mao_53", "mao_55", "mao_56", "mao_57", "mao_59", "mao_60");
    grupo['tipo_6'] = new Array("mao_26", "mao_27", "mao_29", "mao_30");
    grupo['tipo_7'] = new Array("mao_22", "mao_28", "mao_58");
    grupo['tipo_8'] = new Array("mao_3", "mao_4", "mao_5", "mao_6", "mao_39", "mao_40", "mao_50", "mao_51");
    grupo['tipo_9'] = new Array("mao_41", "mao_42");
    grupo['tipo_10'] = new Array("mao_43", "mao_44", "mao_45", "mao_46");
    grupo['tipo_11'] = new Array("mao_9", "mao_15", "mao_17", "mao_18", "mao_19", "mao_20", "mao_32", "mao_38");
    grupo['tipo_12'] = new Array("mao_1", "mao_2", "mao_7", "mao_10", "mao_11");
    grupo['tipos'] = new Array("mao_14", "mao_48", "mao_36", "mao_54", "mao_60", "mao_26", "mao_28", "mao_50", "mao_42", "mao_44", "mao_38", "mao_2");
    
    /* Modifica o background dos li DOM da section expressao_facial */
    function set_button_bg( group ) {
      var nth_li;
      var exp_num;
      var exp_num_x;
      var exp_num_y;
    
      if( group == "prev" ){
          current_exp_group = "group_" + ( parseInt( current_exp_group.split("_")[1] ) - 1 );
          group = current_exp_group;
      }else if( group == "next" ){
          current_exp_group = "group_" + ( parseInt( current_exp_group.split("_")[1] ) + 1 );
          group = current_exp_group;
      }else{
          current_exp_group = group;
      }
   
      set_pagination();
    
      for( var key in exp_facial[group] ) {
        exp_num = parseInt( key.split("_")[1]  );
      
        if( ( exp_num % 6 ) == 0 ){
          nth_li = ":nth-child(" + 6  + ")";
          exp_num_x = '-' + ( 5 * 133 ) + 'px';
          exp_num_y = '-' + Math.floor( ( exp_num / 6 ) - 1 ) * 135 + 'px';
        }else{
          nth_li = ":nth-child(" +  (exp_num % 6)  + ")";
          exp_num_x = '-' + ( ( exp_num % 6 ) - 1 ) * 133 + 'px';
          exp_num_y = '-' + Math.floor( ( exp_num / 6 ) ) * 135 + 'px' ;
        }
        $("#expressao_facial").find("li").filter(nth_li).css({'background-position': exp_num_x + " " + exp_num_y});
        $("#expressao_facial").find("li").filter(nth_li).attr("title", exp_facial[group][key]);
        $("#expressao_facial").find("li").filter(nth_li).data("exp_facial", key);
      } // Fim do for
    } // Fim da funcao set_button_bg  
    
    // Modifica a aparencia do pagination 
    function set_pagination() {
    
      if( current_exp_group == "group_1" ){
          $('.pagination').find("li").first().addClass("disabled");
      }else{
          $('.pagination').find("li").first().removeClass("disabled");
      }
    
      if( current_exp_group == "group_3" ){
          $('.pagination').find("li").last().addClass("disabled");
      }else{
          $('.pagination').find("li").last().removeClass("disabled");
      }

    } // Fim da funcao set_pagination
    
    // A pagination button is clicked 
    $('.pagination').on( 'click', 'li', function(event){
      event.preventDefault();
      if ( ( $(this).data("exp_group") == "prev" ) && ( current_exp_group != "group_1" ) ){
        set_button_bg( $(this).data("exp_group") );
      }else if ( ( $(this).data("exp_group") == "next" ) && ( current_exp_group != "group_3" ) ){
        set_button_bg( $(this).data("exp_group") );
      }
    
      if ( ( $(this).data("exp_group") != "prev" )  && ( $(this).data("exp_group") != "next" ) ){
        set_button_bg( $(this).data("exp_group") );
      }
    
    });

    // Modifica o background dos li DOM da section formas_de_mao
    function formasDeMaoLiBg(hand_type) {
      $("#tipos_de_mao").find('li').hide();

      for( var i = 0; i < grupo[hand_type].length; i++ ) {
          var nth_li = ":nth-child(" + (i+1) + ")";
          var mao_num = parseInt( grupo[hand_type][i].split("_")[1] );
          var mao_num_x;
          var mao_num_y;
      
          if( ( mao_num % 10 ) == 0 ) { // Ultima imagem da linha do sprite
            mao_num_x = '-' + 9 * 65 + 'px'; 
            mao_num_y = '-' + Math.floor( ( mao_num / 10 ) - 1 ) * 80 + 'px';
          }else{
            mao_num_x = '-' + ( ( mao_num % 10 ) - 1 ) * 65 + 'px';
            mao_num_y = '-' + Math.floor( ( mao_num / 10 ) ) * 80 + 'px';
          }
      
          $("#tipos_de_mao").find("li").filter(nth_li).css({'background-position' : mao_num_x + " " + mao_num_y });
      
	  if (hand_type == "tipos") { 
            $("#tipos_de_mao").find("li").filter(nth_li).data('handshape', 'tipo_' + (i + 1));
          } else {
            $("#tipos_de_mao").find("li").filter(nth_li).data('handshape', 'conf_' + mao_num);
          }

          $("#tipos_de_mao").find("li").filter(nth_li).fadeIn();
          $("#tipos_de_mao").find('li').last().fadeIn();
      } // Fim do for    
    } // Fim da funcao formasDeMaoLiBg

    function mostrarPergunta() {
      $('#quantidade_maos').hide();
      $('#orientacao_palma_da_mao').hide();
      $('#expressao_facial').hide();
      $('#ponto_de_articulacao').hide();
      $('#tipos_de_mao').hide();
	
      var pergunta;
        
      if (state == "ORIENT_PALMA"){
	if (isRightHand){
		pergunta = "Escolha a orienta&ccedil;&atilde;o inicial da palma da m&atilde;o direita.";
	} else {
		pergunta = "Escolha a orienta&ccedil;&atilde;o inicial da palma da m&atilde;o esquerda.";
	}
        $('#orientacao_palma_da_mao').show();
      }
      else if (state == "EXP_FACIAL") {
	pergunta = "Com que express&atilde;o facial se faz o sinal?";
        set_button_bg("group_1");  
        $('#expressao_facial').show();
      }
      else if (state == "PONTO_ARTIC") {
	if (isRightHand) {
		pergunta = "Selecione o ponto de articula&ccedil;&atilde;o da m&atilde;o direita.";
	} else {
		pergunta = "Selecione o ponto de articula&ccedil;&atilde;o da m&atilde;o esquerda.";
	}
        $('#ponto_de_articulacao').show();
        $("#avatar_completo_img").show();
      }
      else if (state == "TIPOS_MAO") {
	if (isRightHand) {
		 pergunta = "Escolha a forma inicial da m&atilde;o direita.";
	} else {
		pergunta = "Escolha a forma inicial da m&atilde;o esquerda.";
	}

	formasDeMaoLiBg('tipos', isRightHand)
        $('#tipos_de_mao').show();
      }
      else if (state == "QTD_MAOS") {
	pergunta = "Com quantas m&atilde;os se faz o sinal?"
        $('#quantidade_maos').show();
      }
      else if (state == "DIST_MAOS") {
	if (isRightHand) {
		 pergunta = "A que dist&acirc;ncia do corpo a m&atilde;o direita faz o sinal?";
	} else {
		pergunta = "A que dist&acirc;ncia do corpo a m&atilde;o esquerda faz o sinal?";
	}

        $('#ponto_de_articulacao').show();
      }
      else if (state == "RENDER") {
	pergunta = "O avatar renderizado est&aacute; correto?";
      }

      $("#question").html( pergunta );
    } // Fim da funcao mostrarPergunta

    function saveAnswer(answer) {

	if (state == "EXP_FACIAL" || state == "QTD_MAOS") {
		parametros[state] = answer;
		return;
	} 		

	saveState = state;

	if (saveState == "DIST_MAOS") {
		saveState = "PONTO_ARTIC";
	}

	if (isRightHand) {
		parametros.right[saveState] = answer;
	} else {
		parametros.left[saveState] = answer;
	}	
    }

    function updateState(answer) {
	
	var nextState = "";

	if (state == "TIPOS_MAO") {
	     nextState = "CONF_MAO";
	} else if (state == "CONF_MAO") {
	     nextState = "ORIENT_PALMA";
	} else if (state == "ORIENT_PALMA") {
	     nextState = "PONTO_ARTIC";
	} else if (state == "PONTO_ARTIC") {
	     nextState = "DIST_MAOS";
	} else if (state == "DIST_MAOS"){
	     if (isRightHand) {
		nextState = "QTD_MAOS";
	     } else {
		nextState = "EXP_FACIAL";
	     }
	} else if (state == "QTD_MAOS") {
	     if (answer == "uma") {
		nextState = "EXP_FACIAL";
	     } else {
		nextState = "TIPOS_MAO";
		isRightHand = false;
             }
	} else if (state == "EXP_FACIAL") {
		nextState = "RENDER";
	}

	state = nextState;
	console.log(state);
     }

     function stopAndPlaySignalVideo (toPlay) {
	autoplay_Id = toPlay ? 1 : 0;
        $('#signal_video').html(function(){
            var video_id = task.info.video_id;
            return '<iframe type="text/html" width="540" height="450" src="http://www.youtube.com/embed/' + 
            video_id + '?autoplay=' + autoplay_Id + '&version=3&loop=1&playlist=' + video_id + '" />'});
     }

     function showRenderedVideo(result) {
	console.log(result);
	$.unblockUI();
	mostrarPergunta();

	stopAndPlaySignalVideo(true);
        $('#avatar_video').html(function(){
	      return '<video width="395" height="450" controls="true" autoplay="autoplay" loop="true"> <source src="/libras-videos/' + result.rendered_video + '.webm"> </video>'});
	$('#avatar_video').show();
     }

    function renderizarVideo() {
        console.log(parametros);
	console.log(parametros.right);
	console.log(parametros.left);

	$.blockUI({message: "Rendering..."});
	stopAndPlaySignalVideo(false);

	jQuery.ajax({
 	  type: 'POST',
	  url:    '/render',
	  contentType: 'application/json',
	  data: JSON.stringify(parametros),
	  success: function(result) {
	    showRenderedVideo(result);
	  },
	  error: function(result) {
	    alert("error!");
	  },
	  async: true
	});

    } // Fim da funcao renderizarVideo

    if ( !$.isEmptyObject(task) ) {
      
        stopAndPlaySignalVideo(true);
        
        $('#task-id').html(task.id);
	parametros['signal_name'] = task.info.signal_name;
 	
        mostrarPergunta(state);
        
        $('.btn-answer').off('click').on('click', function(){
            var answer = $(this).attr('value');
            if( typeof answer != 'undefined' ){
              saveAnswer(answer);
              updateState(answer);	
              mostrarPergunta(state);
            }else{
              $("#error").show();
            }
        });
         
	 // Eventos de cliques em pontos de articulação
         var local_answer;
         $("#avatar_completo").find("area").off('click').on('click', function(event){
           event.preventDefault();         
           local_answer = $(this).data('local');         
 	   updateState(local_answer);
	   mostrarPergunta();

           $("#avatar_completo_img").hide();
           $("#avatar_distancia_img").fadeIn();
         });
  
         $("#avatar_distancia").find("area").off('click').on('click', function(event){
           event.preventDefault();
           $("#avatar_distancia_img").hide();
           local_answer = "Pa_" + (parseInt(local_answer.split('_')[1]) + $(this).data('local'));

           saveAnswer(local_answer); 
 	   updateState(local_answer);
	   mostrarPergunta();
         });

	// Eventos de cliques em tipos de mão
         $("#tipos_de_mao").find("li").off("click").on( "click", function() {
	   answer = $(this).data('handshape');

	   if (state == "TIPOS_MAO") {
	 	formasDeMaoLiBg(answer);
	 	updateState(answer);
	   } else if (state == "CONF_MAO") {
		saveAnswer(answer); 
	 	updateState(answer);
	   	mostrarPergunta();
	   }	
         });

         // Eventos de cliques em expressao facial
         var exp_answer;
         $('.exp').off('click').on( 'click', function(){
           exp_answer = $(this).data('exp_facial');
           saveAnswer(exp_answer);
           updateState(exp_answer);
          
           renderizarVideo();
         });
    }
    else {
        $(".skeleton").hide();
        $("#loading").hide();
        $("#finish").fadeIn(500);
    } 
});

pybossa.setEndpoint('/pybossa');
pybossa.run('librasdictionary');

</script>

<style type="text/css">

  #tipos_de_mao li{
    margin: 5px 0 0 5px;
    float: left;
    width: 65px;
    height: 80px;
    display: inline;
    list-style: none;
    background: url("http://imageshack.us/a/img5/1439/spritehandsshape.png") no-repeat;
  }

  #tipos_de_mao li:last-child {
    background: #FFF;
  }
 
  section#expressao_facial {
    /*padding: 0;*/
  }
  
  section#expressao_facial li.exp {
    float: left;
    list-style: none;
    width: 133px;
    height: 133px;
    margin: 6px 0 0 5px;
    background: url("http://imageshack.us/a/img850/2828/l19.png") no-repeat;
    position: relative;
  }
  
  section#expressao_facial li.exp:hover {
    -webkit-box-shadow: inset 0 0 10px #F70;
    -moz-box-shadow: inset 0 0 10px #F70;
    box-shadow: inset 0 0 10px #F70;
  }

  .clear{
    float: both
  }

</style>
